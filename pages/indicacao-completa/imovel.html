<div id="indicar" class="container">
    <div class="row">
        <form id="nova-indicacao">
            <div class="load-dados-cliente"></div>
            <div class="load-dados-endereco"></div>
            <div class="col-12 mb-3">
                <div class="card">
                    <div class="card-header">
                        Informações do negócio
                    </div>
                    <div class="card-body load-dados-informacoes">
                    </div>
                </div>
            </div>
            <div class="col-12">
                <a href="#" data-page="indicar" class="item-load-page btn btn-link link-voltar-cad">Cadastro rápido</a>
                <button type="submit" class="btn btn-success float-right">Salvar</button>
            </div>
        </form>
    </div>
</div>

<script>
    Imovel = function() {
        $this = this;

        ImovelMethods = {
            initialize: function() {
                this.onLoad();
                this.getTipoUso();
            },
            onLoad: function() {
                $('#indicar .load-dados-cliente').empty().html(getFieldsFormCliente());
                $('#indicar .load-dados-endereco').empty().html(getFieldsFormEndereco());
                $('#indicar .load-dados-informacoes').empty().html(ImovelMethods.buildForm());
                $('.money').maskMoney({
                    prefix: 'R$ ',
                    allowNegative: true,
                    thousands: '.',
                    decimal: ',',
                    affixesStay: false
                });
                $('.phone').mask(SPMaskBehavior, spOptions);
                $('.link-voltar-cad').attr('data-produto',PARAM_PAGE.produto);
                $('.link-voltar-cad').attr('data-title',PARAM_PAGE.title);

            },
            buildForm: function() {
                var html = '';
                html += '<div class="row">';
                html += addInput(null, {
                    type: "hidden",
                    value: 1,
                    name: 'idProdutoIndicacao'
                }, '');
                html += addSelect('Tipo do negócio', {
                    id: 'tipo',
                    validate: 'required',
                    name: 'tipo'
                }, 'col-md-12 col-lg-2', {
                    1: 'Proprietário',
                    2: 'Interessado',
                });
                html += addSelect('Operação', {
                    id: 'idTipoOperacao',
                    validate: 'required',
                    name: 'idTipoOperacao'
                }, 'col-md-12 col-lg-2', {
                    1: 'Comprar',
                    2: 'Alugar',
                    3: 'Vender'
                });
                html += addSelect('Tipo de uso', {
                    id: 'idTipoUso',
                    validate: 'required',
                    name: 'idTipoUso'
                }, 'col-md-12 col-lg-2', {
                    1: 'Residêncial',
                    2: 'Comercial'
                });
                html += addSelect('Tipo do imóvel', {
                    id: 'idTipoImovel',
                    validate: 'required',
                    name: 'idTipoImovel',
                    disabled: true
                }, 'col-md-12 col-lg-3', {});
                html += addInput('Valor do bem', {
                    type: "text",
                    id: 'ValorBem',
                    name: 'ValorBem',
                    class: 'money',
                    validate: 'required'
                }, 'col-md-12 col-lg-3');
                html += addInput('Bairro de preferência (1)', {
                    type: "text",
                    id: 'PrimeiroBairroPreferencia',
                    name: 'PrimeiroBairroPreferencia'
                }, 'col-md-12 col-lg-4');
                html += addInput('Bairro de preferência (2)', {
                    type: "text",
                    id: 'SegundoBairroPreferencia',
                    name: 'SegundoBairroPreferencia'
                }, 'col-md-12 col-lg-4');
                html += addInput('Bairro de preferência (3)', {
                    type: "text",
                    id: 'TerceiroBairroPreferencia',
                    name: 'TerceiroBairroPreferencia'
                }, 'col-md-12 col-lg-4');
                html += addTextarea('Observações', {
                    row: "3",
                    name: 'observacoes'
                }, '', 'col-md-12 col-lg-12');


                html += '<script>';
                html += '$(function() {';
                html += '});';
                html += '<\/script>';
                html += '</div>';
                return html;
            },
            getTipoUso: function() {
                $('#idTipoUso').change(function() {
                    var id = $(this).val();
                    if (!id) {
                        var html = '';
                        html += '<option value="">';
                        html += '.: Selecione :.';
                        html += '</option>';
                        $('#idTipoImovel').empty().html(html).attr('disabled', 'disabled');
                    } else {
                        jQuery.gApi.exec('GET', 'http://integracaogtsis.tempsite.ws/api/Imoveis/TipoImovel/Uso/' + id, {},
                            function(json) {
                                if (sizeObj(json) > 0) {
                                    $('#idTipoImovel').empty();
                                    $.each(json, function(i, item) {
                                        var html = '<option value="' + item.id + '">';
                                        html += item.Tipo;
                                        html += '</option>';
                                        $('#idTipoImovel').append(html).removeAttr('disabled');
                                    });

                                }
                            },
                            function(err) {
                                console.log(err);
                            });
                    }

                });
            }
        }
        ImovelMethods.initialize();
    };

    $(function() {
        Imovel();
    });
</script>